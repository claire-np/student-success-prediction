r
print("Hello, R world!")
'q()'
q()
install.packages(c("tidyverse", "caret", "tidylog", "randomForest", "rmarkdown", "ggplot2"))
library(tidyverse)
library(caret)
library(randomForest)
getwd()
list.files()
list.files("scripts")
getwd()
list.files()
list.files("scripts")
getwd()
list.files()
list.files("scripts")
getwd()
list.files()
list.files("scripts")
cat("---- SCRIPT 03 START ----\n")
proj_path <- rstudioapi::getActiveProject()
setwd(proj_path)
setwd(/Users/phuonglinh39/student-success-prediction-r)
setwd(Users/phuonglinh39/student-success-prediction-r)
load("~/student-success-prediction-r/results/tables/error_table.rds")
head(error_table, 20)
head(error_table.rds, 20)
file.exists("results/tables/error_table.rds")
list.files("results/tables")
getwd()
normalizePath("results/tables")
setwd("~/student-success-prediction-r")
getwd()
list.files("results/tables")
err <- readRDS("results/tables/error_table.rds")
head(err[order(-err$abs_error), ], 15)
subj <- readRDS("results/tables/subject_performance.rds")
subj
seg <- readRDS("results/tables/segment_performance.rds")
seg
pred <- readRDS("results/tables/prediction_table.rds")
head(pred, 20)
reason <- readRDS("results/tables/enrollment_reason_performance.rds")
reason
source("scripts/10_insight_engine.R")
source("scripts/10_insight_engine.R")
# -------------------------------------------------------------
# 09_insight_engine.R
# Generate deep EdTech insights + visualization from performance tables
# -------------------------------------------------------------
cat("---- SCRIPT 10: INSIGHT ENGINE START ----\n")
library(tidyverse)
library(ggplot2)
# Ensure output folder exists
if (!dir.exists("results/insights")) dir.create("results/insights", recursive = TRUE)
# -------------------------------------------------------------
# Load required data
# -------------------------------------------------------------
cat("Loading tables...\n")
pred <- readRDS("results/tables/prediction_table.rds")
error_tbl <- readRDS("results/tables/error_table.rds")
subj <- readRDS("results/tables/subject_performance.rds")
seg <- readRDS("results/tables/segment_performance.rds")
reason <- readRDS("results/tables/enrollment_reason_performance.rds")
# -------------------------------------------------------------
# 1. Insight: Subject difficulty (curriculum heatmap)
# -------------------------------------------------------------
p_subject <- subj %>%
ggplot(aes(x = subject, y = rmse_subject, fill = rmse_subject)) +
geom_col() +
scale_fill_gradient(low = "#c7e9b4", high = "#084081") +
labs(
title = "Subject-Level Prediction Difficulty (RMSE)",
x = "Subject",
y = "RMSE"
) +
theme_minimal()
ggsave("results/insights/subject_rmse.png", p_subject, width = 7, height = 4)
# -------------------------------------------------------------
# 2. Insight: Enrollment reason variability
# -------------------------------------------------------------
p_reason <- reason %>%
ggplot(aes(reorder(enrollment_reason, rmse_reason), rmse_reason, fill = rmse_reason)) +
geom_col() +
coord_flip() +
scale_fill_gradient(low = "#fdd0a2", high = "#990000") +
labs(
title = "Prediction Error by Enrollment Reason",
x = "Enrollment Reason",
y = "RMSE"
) +
theme_minimal()
ggsave("results/insights/reason_rmse.png", p_reason, width = 7, height = 4)
# -------------------------------------------------------------
# 3. Segment analysis (Motivation x Engagement)
# -------------------------------------------------------------
p_segment <- seg %>%
ggplot(aes(x = motivation_band, y = engagement_band, fill = rmse_segment)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "#edf8fb", high = "#006d2c") +
labs(
title = "RMSE Heatmap: Motivation × Engagement Segments",
x = "Motivation Band",
y = "Engagement Band"
) +
theme_minimal()
ggsave("results/insights/segment_rmse_heatmap.png", p_segment, width = 6, height = 5)
# -------------------------------------------------------------
# 4. High-error students (top 10 worst predictions)
# -------------------------------------------------------------
top10 <- pred %>% arrange(desc(abs_error)) %>% slice(1:10)
saveRDS(top10, "results/insights/top10_worst_predictions.rds")
# -------------------------------------------------------------
# 5. Error distribution (diagnostic)
# -------------------------------------------------------------
p_error <- pred %>%
ggplot(aes(abs_error)) +
geom_histogram(bins = 30, fill = "#3182bd", color = "white", alpha = 0.8) +
labs(
title = "Distribution of Absolute Prediction Errors",
x = "Absolute Error",
y = "Count"
) +
theme_minimal()
ggsave("results/insights/error_distribution.png", p_error, width = 7, height = 4)
# -------------------------------------------------------------
# 6. Motivation vs Error (non-linear pattern)
# -------------------------------------------------------------
p_mot <- pred %>%
ggplot(aes(motivation_score, abs_error)) +
geom_point(alpha = 0.4, color = "#2b8cbe") +
geom_smooth(color = "red", method = "loess") +
labs(
title = "Motivation vs Prediction Error",
x = "Motivation Score",
y = "Absolute Error"
) +
theme_minimal()
ggsave("results/insights/motivation_vs_error.png", p_mot, width = 7, height = 4)
# -------------------------------------------------------------
# 7. Time Spent vs Final Grade vs Error
# -------------------------------------------------------------
p_spend <- pred %>%
ggplot(aes(time_spent, final_grade, color = abs_error)) +
geom_point(alpha = 0.7) +
scale_color_gradient(low = "green", high = "red") +
labs(
title = "Time Spent vs Final Grade (Error Highlighted)",
x = "Time Spent",
y = "Final Grade",
color = "Abs Error"
) +
theme_minimal()
ggsave("results/insights/time_vs_grade_error.png", p_spend, width = 7, height = 4)
# -------------------------------------------------------------
# Print Insights
# -------------------------------------------------------------
cat("\n---- KEY INSIGHTS ----\n")
cat("\n1) Subjects with highest prediction difficulty:\n")
print(subj %>% arrange(desc(rmse_subject)) %>% head(3))
cat("\n2) Enrollment reasons with unstable performance:\n")
print(reason %>% arrange(desc(rmse_reason)) %>% head(3))
cat("\n3) Segment at highest risk (Motivation × Engagement):\n")
print(seg %>% arrange(desc(rmse_segment)) %>% head(3))
cat("\n4) Top 10 highest-error students saved.\n")
cat("5) Visualizations saved to results/insights/.\n")
cat("---- SCRIPT 09: INSIGHT ENGINE COMPLETE ----\n")
# -------------------------------------------------------------
# 09_insight_engine.R
# Generate deep EdTech insights + visualization from performance tables
# -------------------------------------------------------------
cat("---- SCRIPT 10: INSIGHT ENGINE START ----\n")
library(tidyverse)
library(ggplot2)
# Ensure output folder exists
if (!dir.exists("results/insights")) dir.create("results/insights", recursive = TRUE)
# -------------------------------------------------------------
# Load required data
# -------------------------------------------------------------
cat("Loading tables...\n")
pred <- readRDS("results/tables/prediction_table.rds")
error_tbl <- readRDS("results/tables/error_table.rds")
subj <- readRDS("results/tables/subject_performance.rds")
seg <- readRDS("results/tables/segment_performance.rds")
reason <- readRDS("results/tables/enrollment_reason_performance.rds")
# -------------------------------------------------------------
# 1. Insight: Subject difficulty (curriculum heatmap)
# -------------------------------------------------------------
p_subject <- subj %>%
ggplot(aes(x = subject, y = rmse_subject, fill = rmse_subject)) +
geom_col() +
scale_fill_gradient(low = "#c7e9b4", high = "#084081") +
labs(
title = "Subject-Level Prediction Difficulty (RMSE)",
x = "Subject",
y = "RMSE"
) +
theme_minimal()
ggsave("results/insights/subject_rmse.png", p_subject, width = 7, height = 4)
# -------------------------------------------------------------
# 2. Insight: Enrollment reason variability
# -------------------------------------------------------------
p_reason <- reason %>%
ggplot(aes(reorder(enrollment_reason, rmse_reason), rmse_reason, fill = rmse_reason)) +
geom_col() +
coord_flip() +
scale_fill_gradient(low = "#fdd0a2", high = "#990000") +
labs(
title = "Prediction Error by Enrollment Reason",
x = "Enrollment Reason",
y = "RMSE"
) +
theme_minimal()
ggsave("results/insights/reason_rmse.png", p_reason, width = 7, height = 4)
# -------------------------------------------------------------
# 3. Segment analysis (Motivation x Engagement)
# -------------------------------------------------------------
p_segment <- seg %>%
ggplot(aes(x = motivation_band, y = engagement_band, fill = rmse_segment)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "#edf8fb", high = "#006d2c") +
labs(
title = "RMSE Heatmap: Motivation × Engagement Segments",
x = "Motivation Band",
y = "Engagement Band"
) +
theme_minimal()
ggsave("results/insights/segment_rmse_heatmap.png", p_segment, width = 6, height = 5)
# -------------------------------------------------------------
# 4. High-error students (top 10 worst predictions)
# -------------------------------------------------------------
top10 <- pred %>% arrange(desc(abs_error)) %>% slice(1:10)
saveRDS(top10, "results/insights/top10_worst_predictions.rds")
# -------------------------------------------------------------
# 5. Error distribution (diagnostic)
# -------------------------------------------------------------
p_error <- pred %>%
ggplot(aes(abs_error)) +
geom_histogram(bins = 30, fill = "#3182bd", color = "white", alpha = 0.8) +
labs(
title = "Distribution of Absolute Prediction Errors",
x = "Absolute Error",
y = "Count"
) +
theme_minimal()
ggsave("results/insights/error_distribution.png", p_error, width = 7, height = 4)
# -------------------------------------------------------------
# 6. Motivation vs Error (non-linear pattern)
# -------------------------------------------------------------
p_mot <- pred %>%
ggplot(aes(motivation_score, abs_error)) +
geom_point(alpha = 0.4, color = "#2b8cbe") +
geom_smooth(color = "red", method = "loess") +
labs(
title = "Motivation vs Prediction Error",
x = "Motivation Score",
y = "Absolute Error"
) +
theme_minimal()
ggsave("results/insights/motivation_vs_error.png", p_mot, width = 7, height = 4)
# -------------------------------------------------------------
# 7. Time Spent vs Final Grade vs Error
# -------------------------------------------------------------
p_spend <- pred %>%
ggplot(aes(time_spent, final_grade, color = abs_error)) +
geom_point(alpha = 0.7) +
scale_color_gradient(low = "green", high = "red") +
labs(
title = "Time Spent vs Final Grade (Error Highlighted)",
x = "Time Spent",
y = "Final Grade",
color = "Abs Error"
) +
theme_minimal()
ggsave("results/insights/time_vs_grade_error.png", p_spend, width = 7, height = 4)
# -------------------------------------------------------------
# Print Insights
# -------------------------------------------------------------
cat("\n---- KEY INSIGHTS ----\n")
cat("\n1) Subjects with highest prediction difficulty:\n")
print(subj %>% arrange(desc(rmse_subject)) %>% head(3))
cat("\n2) Enrollment reasons with unstable performance:\n")
print(reason %>% arrange(desc(rmse_reason)) %>% head(3))
cat("\n3) Segment at highest risk (Motivation × Engagement):\n")
print(seg %>% arrange(desc(rmse_segment)) %>% head(3))
cat("\n4) Top 10 highest-error students saved.\n")
cat("5) Visualizations saved to results/insights/.\n")
cat("---- SCRIPT 10: INSIGHT ENGINE COMPLETE ----\n")
source("scripts/10_insight_engine.R")
library(shiny)
library(dplyr)
library(ggplot2)
library(readr)
library(DT)
# Load all data
pred_table  <- readRDS("results/tables/prediction_table.rds")
error_table <- readRDS("results/tables/error_table.rds")
subject_perf <- readRDS("results/tables/subject_performance.rds")
segment_perf <- readRDS("results/tables/segment_performance.rds")
reason_perf <- readRDS("results/tables/enrollment_reason_performance.rds")
# UI --------------------------------------------------------------------------------------------
ui <- fluidPage(
titlePanel("Student Success Prediction Dashboard – Advanced Version"),
sidebarLayout(
sidebarPanel(
h3("Filters"),
selectInput("subject", "Subject:",
choices = c("All", unique(pred_table$subject)),
selected = "All"),
selectInput("reason", "Enrollment Reason:",
choices = c("All", unique(pred_table$enrollment_reason)),
selected = "All"),
sliderInput("gradeRange", "Final Grade Range:",
min = 0, max = 100, value = c(0, 100)),
hr(),
downloadButton("downloadData", "Download Filtered Data")
),
mainPanel(
tabsetPanel(
tabPanel("Model Performance",
h3("Model Comparison Summary"),
DTOutput("modelComparison")
),
tabPanel("Feature Importance",
h3("Top Predictors (Random Forest)"),
plotOutput("varImpPlot", height = "500px")
),
tabPanel("Subject Difficulty",
h3("Prediction Error by Subject"),
plotOutput("subjectPlot", height = "500px"),
tableOutput("subjectTable")
),
tabPanel("Enrollment Reason",
h3("Error by Enrollment Reason"),
plotOutput("reasonPlot", height = "500px"),
tableOutput("reasonTable")
),
tabPanel("Motivation × Engagement",
h3("Segment Heatmap (RMSE)"),
plotOutput("segmentHeatmap", height = "500px"),
tableOutput("segmentTable")
),
tabPanel("Error Explorer",
h3("Prediction Error Distribution"),
plotOutput("errorDist", height = "500px"),
DTOutput("worstCases")
),
tabPanel("Student Drill-Down",
h3("Filtered Student Records"),
DTOutput("studentTable")
)
)
)
)
)
# SERVER ----------------------------------------------------------------------------------------
server <- function(input, output) {
# Filtered Data
filtered_data <- reactive({
df <- pred_table
if (input$subject != "All") {
df <- df %>% filter(subject == input$subject)
}
if (input$reason != "All") {
df <- df %>% filter(enrollment_reason == input$reason)
}
df %>% filter(final_grade >= input$gradeRange[1],
final_grade <= input$gradeRange[2])
})
# Download
output$downloadData <- downloadHandler(
filename = function() { "filtered_students.csv" },
content = function(file) {
write_csv(filtered_data(), file)
}
)
# Model Comparison Table
output$modelComparison <- renderDT({
readRDS("results/tables/model_comparison.rds")
})
# Feature Importance (Random Forest)
output$varImpPlot <- renderPlot({
imp <- readRDS("results/models/rf_model.rds")$finalModel$variable.importance
imp_df <- data.frame(
Feature = names(imp),
Importance = imp
) %>% arrange(desc(Importance)) %>% head(15)
ggplot(imp_df, aes(x = reorder(Feature, Importance), y = Importance)) +
geom_col(fill = "#4682B4") +
coord_flip() +
labs(x = "Feature", y = "Importance")
})
# Subject Difficulty
output$subjectPlot <- renderPlot({
ggplot(subject_perf, aes(x = subject, y = rmse_subject, fill = subject)) +
geom_col() +
labs(y = "RMSE", x = "Subject")
})
output$subjectTable <- renderTable(subject_perf)
# Enrollment Reason
output$reasonPlot <- renderPlot({
ggplot(reason_perf, aes(x = enrollment_reason, y = rmse_reason, fill = enrollment_reason)) +
geom_col() +
labs(y = "RMSE", x = "Enrollment Reason")
})
output$reasonTable <- renderTable(reason_perf)
# Segment Heatmap
output$segmentHeatmap <- renderPlot({
ggplot(segment_perf, aes(x = engagement_band, y = motivation_band, fill = rmse_segment)) +
geom_tile() +
scale_fill_gradient(low = "#D0E1F2", high = "#1C4E80") +
labs(x = "Engagement Band", y = "Motivation Band", fill = "RMSE")
})
output$segmentTable <- renderTable(segment_perf)
# Error Distribution
output$errorDist <- renderPlot({
ggplot(error_table, aes(x = abs_error)) +
geom_histogram(binwidth = 5, fill = "#6495ED", color = "white") +
labs(x = "Absolute Error", y = "Count")
})
# Worst Cases
output$worstCases <- renderDT({
error_table %>% arrange(desc(abs_error)) %>% head(20)
})
# Full student table
output$studentTable <- renderDT({
filtered_data()
})
}
# RUN -------------------------------------------------------------------------------------------
shinyApp(ui = ui, server = server)
